#!/usr/bin/env ruby
$:.unshift(File.dirname(__FILE__) + "/../lib")
require "poolparty"
# require "poolpartycl"
require 'git-style-binary/command'

GitStyleBinary.command do  
  version "PoolParty cloud command"  
  banner <<-EOS
Usage: #{$0} #{all_options_string} COMMAND [ARGS]

  List the clouds and their nodes
EOS

  short_desc "List the clouds"
  opt :inst_num, "The number of the instance to run bootstrap on", :type => :int
  
  run do |command|    
    @cloud = @loaded_clouds.first
    nodes = @cloud.nodes(:status => "running")
    
    if !nodes.empty?
      n = command[:inst_num] ? command[:inst_num].to_i : 0
      @cloud.ssh_into( nodes[n].ip ) if @cloud
    else
      puts "No running instances can be found"
    end
    
  end    
end