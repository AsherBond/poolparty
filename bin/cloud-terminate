#!/usr/bin/env ruby
$:.unshift(File.dirname(__FILE__) + "/../lib")
require "poolparty"
# require "poolpartycl"
require 'git-style-binary/command'

GitStyleBinary.command do  
  version "PoolParty cloud command"  
  banner <<-EOS
Usage: #{$0} #{all_options_string} COMMAND [ARGS]

  List the clouds and their nodes
EOS

  short_desc "List the clouds"

  run do |command|    
    @loaded_clouds.each do |cld|
      
      cld.nodes(:status => "running").each do |inst|
        msg = <<-EOM
    Shutting down #{inst.instance_id}
    Are you sure? (Y/N)
        EOM
    
        if o.yes?
          puts "Shutting down #{inst.instance_id}"
          cld.terminate_instance!(:instance_id => inst.instance_id)
        else
          if are_you_sure?(msg)
            puts "Shutting down #{inst.instance_id}"
            cld.terminate_instance!(:instance_id => inst.instance_id)
          end
        end
      end
      
    end    
  end
end