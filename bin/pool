#!/usr/bin/ruby
require 'optparse'
$:.unshift(File.join(File.dirname(__FILE__), "..", "lib"))
require "poolparty"
require "#{File.dirname(__FILE__) + '/../lib/poolparty/helpers/binary.rb'}"

# Get the git-style program action
name = ARGV.shift

# If there was no program action given
unless name
  puts "Usage: #{ARGV[0]} <action> <options>"
  puts "Pool actions:"
  puts Binary.list_binaries
  exit
end

program_name = "#{File.basename($0)}-#{name}"
program_location = File.join(Binary.binary_directory, program_name)
command_line = "#{program_location} #{ARGV.join(" ")}"

# Run it from the command-line first
if !Binary.available_binaries.include?(program_name)
  exec "#{command_line}"
else
  puts "Unknown poolparty binary: #{program_name}"
end