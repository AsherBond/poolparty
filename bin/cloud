#!/usr/bin/env ruby
$:.unshift(File.dirname(__FILE__) + "/../lib")
require "poolparty"
require 'git-style-binary/command'

GitStyleBinary.primary do
  @theme = :short
  
  version "PoolParty cloud command"  
  banner <<-EOS
Usage: #{$0} #{all_options_string} COMMAND [ARGS]

The cloud subcommands commands are:
  \#{GitStyleBinary.pretty_known_subcommands(:short).join("  ")}

See 'cloud help COMMAND' for more information on a specific command.
EOS
  
  opt :debug, "Debug the output", :type => :boolean, :default => false
  opt :clouds_dot_rb, "Set the clouds.rb file", :type => String, :default => "clouds.rb"
  opt :testing, "Set testing mode on", :type => :boolean, :default => false
  opt :name, "Name of the working cloud", :type => String, :default => nil

  before_run do |command|
    # Setup testing/debugging
    $TESTING = true if command[:testing]
    $DEBUGGING = true if command[:debug]
    
    @loaded_pool = PoolParty::Pool.find_and_load_default_clouds_dot_rb(command[:clouds_dot_rb])
    @loaded_clouds = @loaded_pool.clouds.map {|name, cld| cld }
    @loaded_clouds.map do |cld| 
      cld.verbose = command[:verbose]
      cld.debug = command[:debug]
    end
  end
  
  run do |command|
    subcommands = GitStyleBinary.list_subcommands
    
    puts "Usage: cloud COMMAND [ARGS]
    
    The cloud subcommands commands are:
      #{subcommands}

    See 'cloud help COMMAND' for more information on a specific command"
  end
end