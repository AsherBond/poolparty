#!/usr/bin/env ruby
$:.unshift(File.dirname(__FILE__) + "/../lib")
require "poolparty"
# require "poolpartycl"
require 'git-style-binary/command'

GitStyleBinary.command do  
  version "PoolParty cloud command"  
  banner <<-EOS
Usage: #{$0} #{all_options_string} COMMAND [ARGS]

  List the clouds and their nodes
EOS

  short_desc "List the clouds"

  run do |command|    
    @loaded_clouds.each do |cld|
      
        begin
          if cld.verifiers.size > 0
            cld.passing?
            cld.vputs "Cloud passed verification"
          else
            raise "Your cloud doesn't have any verifiers!"
            exit 2
          end
        rescue Exception => e
           cld.vputs <<-EOM
      
            Verification failed: #{e}"
              Please check your clouds.rb for any errors
      
            Exception: #{e.class}: #{e.message}\n\t#{e.backtrace.join("\n\t")}
      
            EOM
        end
      
    end    
  end
end