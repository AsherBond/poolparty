#!/usr/bin/env ruby
$:.unshift(File.dirname(__FILE__) + "/../lib")
require "poolparty"
# require "poolpartycl"
require 'git-style-binary/command'

GitStyleBinary.command do  
  version "PoolParty cloud command"  
  banner <<-EOS
Usage: #{$0} #{all_options_string} COMMAND [ARGS]

  Bootstrap a cloud instance
EOS

  short_desc "Bootstrap a cloud instance"
  
  opt :inst_num, "The number of the instance to run bootstrap on", :type => :int

  run do |command|    
    
    @loaded_clouds.each do |cld|

        # If an IP or DNS name is given, bootstrap that node, otherwise, bootstrap all running nodes.
        # ::FileUtils.rm_rf "#{Default.tmp_path}/" unless o.testing?
        if cld.nodes.empty?
          puts "No nodes to bootstrap"
        else
          if command[:inst_num]
            vputs "\nBootStrapping: #{nodes[o.inst_num]}\n--------------------"
            ::PoolParty::Provision::BootStrapper.new cld.nodes[ command[:inst_num] ], :cloud => cld
          else
            cld.nodes.each do |address|
              cld.vputs "\nBootStrapping: #{address[:ip]}\n--------------------"      
              ::PoolParty::Provision::BootStrapper.new address[:ip], :cloud => cld
            end
          end
        end
      
    end
    
  end
end